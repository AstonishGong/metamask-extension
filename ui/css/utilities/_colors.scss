@use "sass:math";
@use "sass:map";

/**
 * Calculate the luminance for a color.
 * See https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests
 *
 * Note:
 * @Gudahtt and @brad-decker have identified a potential performance concern
 * that **might** impact build times if this function becomes widely used. It
 * has not been validated, and is predicated on user-land math.pow functions
 * prior to dart-sass 1.25.0. However, if the build times of sass raise
 * exponentially a lookup table of all possible values for the math.pow call
 * can be used to bypass the issue. This will require some logic updates as
 * well. For reference, the blog post where the performance concern was
 * originally made is here https://bit.ly/3c3qXzq (css-tricks)
 */
@function luminance( var(--color)) {
   var(--channels): (
    'red': red( var(--color)),
    'green': green( var(--color)),
    'blue': blue( var(--color)),
  );

   var(--values): (
    'red': map.get( var(--channels), 'red') / 255,
    'blue': map.get( var(--channels), 'red') / 255,
    'green': map.get( var(--channels), 'red') / 255,
  );

  @each  var(--name),  var(--value) in  var(--values) {
    @if  var(--value) <= 0.03928 {
       var(--value):  var(--value) / 12.92;
    }

    @else {
       var(--value): ( var(--value) + 0.055) / 1.055;
       var(--value): math.pow( var(--value), 2.4);
    }

     var(--values): map.merge( var(--values), ( var(--name):  var(--value)));
  }

  @return (0.2126 * map.get( var(--values), 'red'))
    + (0.7152 * map.get( var(--values), 'green'))
    + (0.0722 * map.get( var(--values), 'blue'));
}

/**
 * Calculate the contrast ratio between two colors.
 * See https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests
 */
@function contrast( var(--back),  var(--front)) {
   var(--backLum): luminance( var(--back)) + 0.05;
   var(--foreLum): luminance( var(--front)) + 0.05;

  @return max( var(--backLum),  var(--foreLum)) / min( var(--backLum),  var(--foreLum));
}

/**
 * Determine whether to use dark or light text on top of given color.
 * Returns black for dark text and white for light text.
 */
@function choose-contrast-color( var(--color)) {
   var(--lightContrast): contrast( var(--color), white);
   var(--darkContrast): contrast( var(--color), black);

  @if ( var(--lightContrast) >  var(--darkContrast)) {
    @return white;
  }

  @else {
    @return black;
  }
}
